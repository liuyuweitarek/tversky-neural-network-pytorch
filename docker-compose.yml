services:
  dev:
    command: uv run sphinx-autobuild -b html --host 0.0.0.0 --port 8000 docs/source docs/build
    # For keeping the container alive
    stdin_open: true
    tty: true
    container_name: "dev"
    build:
      context: .
      dockerfile: Dockerfile
      args:
        UBUNTU_VERSION: "22.04"          
        PYTHON_VERSION: "3.10"           
        PROJECT_NAME: "tversky_neural_network"
    volumes:
      - .:/tversky_neural_network
    ports:
      - "8000:8000"
    # Sync project with local and rebuild when pyproject.toml changes
    develop:
      watch:
        - action: sync
          path: ./tversky_neural_network
          target: /code
          ignore:
            - .venv/
        - action: rebuild
          path: ./pyproject.toml
    # Using GPU resource if available
    deploy:
      resources:
        reservations:
          devices:
          - driver: nvidia
            count: all
            capabilities: [gpu]
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DISABLE_REQUIRE=1